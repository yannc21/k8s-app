resources:
# GO PIPELINE
  - name: suv_05_src_code_backapp
    type: GitRepo
    configuration:
      path: cyan21/k8s-app
      branches:
        include: master
      files:
        include: ^back\/.+
        exclude: ^back\/CI\/.+
#        exclude: ^back\/CI\/Docker\/.+
      gitProvider: yann_github
      buildOn:
        commit: true
        tagCreate: true


# DOCKER PIPELINE
  - name: suv_05_src_dockerfile_backapp
    type: GitRepo
    configuration:
      path: cyan21/k8s-app
      branches:
        include: master
      files:
        include: ^back\/CI\/Docker\/.+
      gitProvider: yann_github
      buildOn:
        commit: false
        
  # HELM PIPELINE
  # - name: src_helm_chart_app
  #   type: GitRepo
  #   configuration:
  #     path: cyan21/k8s-helm
  #     branches:
  #       include: master
  #     gitProvider: yann_github

  # Build info for the published Go app
  - name: suv_05_build_info_backapp
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu_ssl
      buildName: backapp-go
      buildNumber: ${run_number}

  # - name: build_info_backapp_scanned
  #   type: BuildInfo
  #   configuration:
  #     sourceArtifactory: artifactory_eu
  #     buildName: backapp-go
  #     buildNumber: ${run_number}
  
  - name: suv_05_build_info_backapp_promoted
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu_ssl
      buildName: backapp-go
      buildNumber: ${run_number}

# DOCKER PIPELINE 
  - name: suv_05_backapp_exec
    type: FileSpec
    configuration:
      sourceArtifactory: artifactory_eu_ssl
      pattern: app-generic-rc-local/**/${res_suv_05_build_info_backapp_promoted_appversion}/backend
      buildName: ${triggerBuildInfoName}
      buildNumber: ${triggerBuildInfoNumber}
      flat: true
#      pattern: app-generic/backend
#      aql: '{"name":"backend","@build.name":"backapp_go_pipeline","@build.number":"43"}'
#      aql: "({\"name\":\"backend\"})"

  - name: suv_05_build_info_docker_backapp
    type: BuildInfo
    configuration:
      sourceArtifactory: artifactory_eu_ssl
      buildName: backapp-docker
      buildNumber: ${run_number}

#   - name: build_info_docker_backapp_scanned
#     type: BuildInfo
#     configuration:
#       sourceArtifactory: artifactory_eu
#       buildName: backapp-docker
#       buildNumber: ${run_number}

  # - name: suv_05_build_info_docker_backapp_promoted
  #   type: BuildInfo
  #   configuration:
  #     sourceArtifactory: artifactory_eu_ssl
  #     buildName: backapp-docker
  #     buildNumber: ${run_number}

# # DEPLOY pipeline
#   - name: app_helm_chart
#     type: HelmChart
#     configuration:
#       sourceArtifactory: artifactory_eu
#       repository: app-helm
#       chart: my-app
#       version: 0.0.1
